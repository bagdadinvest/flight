{% extends "new/base.html" %}
{% load static %}

{% block content %}
	<script type="text/javascript" src="{% static 'js/index.js' %}"></script>
	<script type="text/javascript" src="{% static 'js/amadeus.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js" integrity="sha256-T0Vest3aCU7pafRw9r+settMBX6JkKN06dqBnpQ8d30=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/shepherd.js/8.0.0/shepherd.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/shepherd.js/8.0.0/shepherd.css" />
    
    <!-- Enhanced Styles for Flight Results -->
    <style>
        .flight-search-results {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .flight-result-tabs .nav-link {
            color: #666;
            border: 1px solid #ddd;
            margin-right: 5px;
            border-radius: 25px;
        }
        .flight-result-tabs .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
        }
        .amadeus-flight-card {
            border-left: 4px solid #28a745;
            transition: transform 0.2s;
        }
        .amadeus-flight-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }
        .flight-route-visual {
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            height: 3px;
            position: relative;
            margin: 10px 0;
        }
        .flight-route-visual::before {
            content: '✈';
            position: absolute;
            right: -10px;
            top: -8px;
            color: #667eea;
            font-size: 16px;
        }
        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .amadeus-badge {
            background: linear-gradient(45deg, #28a745, #20c997);
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        .price-highlight {
            font-size: 1.5rem;
            font-weight: bold;
            color: #28a745;
        }
        .search-enhancement {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
    </style>

<div class="hero">
	<div class="container">
		<div class="row align-items-center">
			<div class="col-lg-6">
				<div class="intro-wrap">
					<h1 class="mb-5"><span class="d-block">Let's Enjoy Your</span> Trip in <span class="typed-words"></span></h1>

					<div class="slides">
						<img src="{% static 'tour/images/hero-slider-1.jpg' %}" alt="Image" class="img-fluid active">
						<img src="{% static 'tour/images/hero-slider-2.jpg' %}" alt="Image" class="img-fluid">
						<img src="{% static 'tour/images/hero-slider-3.jpg' %}" alt="Image" class="img-fluid">
						<img src="{% static 'tour/images/hero-slider-4.jpg' %}" alt="Image" class="img-fluid">
						<img src="{% static 'tour/images/hero-slider-5.jpg' %}" alt="Image" class="img-fluid">
					</div>
				</div>
			</div>
			<div class="col-lg-6">
				<form class="form" action="{% url 'flight' %}" onsubmit="return flight_search()">
					<div class="align-items-center">
						<div class="search-flight-form-data">
							<div class="input-row" style="display: flex;">
								<div class="form-check-inline">
									<label class="form-check-label">
										<input type="radio" class="form-check-input trip-type" id="one-way" name="TripType" value="1" checked>One-way
									</label>
								</div>
								<div class="form-check-inline">
									<label class="form-check-label">
										<input type="radio" class="form-check-input trip-type" id="round-trip" name="TripType" value="2" {% if trip_type == '2' %}checked{% endif %}>Round Trip
									</label>
								</div>
							</div>
							<div class="input-row">
								<label for="flight-from">From: </label>
								<input type="text" name="Origin" placeholder="From" id="flight-from" class="form-control mr-sm-3" onblur="hideplaces(this)" data-value="{{origin | lower}}" data-list="places_from" autocomplete="off" value="{{origin | upper}}">
								<div id="places_from" class="places_box">
								</div>
							</div>
							<div class="input-row">
								<label for="flight_to">To: </label>
								<input type="text" name="Destination" placeholder="To" id="flight-to" class="form-control mr-sm-3" onblur="hideplaces(this)" data-value="{{destination | lower}}" data-list="places_to" autocomplete="off" value="{{destination | upper}}">
								<div id="places_to" class="places_box">
								</div>
							</div>
							<div class="input-row">
								<label for="depart_date">Departure Date: </label>
								<input type="date" name="DepartDate" min="{{min_date}}" max="{{max_date}}" id="depart_date" placeholder="Date" class="form-control mr-sm-2" value="{{depart_date}}">
							</div>
							<div class="input-row">
								<label for="return_date">Return Date: </label>
								<input type="date" name="ReturnDate" min="{{min_date}}" max="{{max_date}}" id="return_date" placeholder="Date" class="form-control mr-sm-2" value="{{return_date}}" {% if trip_type != '2' %} disabled {% endif %}>
							</div>
							<div class="input-row">
								<label for="seat_class">Class: </label>
								<select name="SeatClass" id="SeatType" class="form-control mr-sm-2 selectpicker">
									<option value="economy" {% if seat == 'economy' %}selected{% endif %}>Economy</option>
									<option value="business" {% if seat == 'business' %}selected{% endif %}>Business</option>
									<option value="first" {% if seat == 'first' %}selected{% endif %}>First</option>
								</select>
							</div>
							<hr>
							<div class="search-enhancement">
								<div class="row">
									<div class="col-md-6">
										<h6><i class="fas fa-database"></i> Traditional Search</h6>
										<p class="small text-muted">Search from our curated flight database</p>
										<button type="submit" class="btn btn-info btn-block">Search Flights</button>
									</div>
									<div class="col-md-6">
										<h6><i class="fas fa-satellite"></i> Live Amadeus Search</h6>
										<p class="small text-muted">Real-time flights from 500+ airlines</p>
										<button type="button" onclick="performAmadeusSearch()" class="btn btn-success btn-block">
											Search Live Flights
										</button>
									</div>
								</div>
								<div class="text-center mt-3">
									<button type="button" onclick="searchAllSources()" class="btn btn-warning btn-lg">
										<i class="fas fa-search"></i> Search All Sources
									</button>
								</div>
							</div>
						</div>
					</div>
				</form>
			</div>	
		</div>
	</div>
</div>

<!-- Flight Search Results Section -->
{% if origin and destination %}
<div class="untree_co-section flight-search-results">
	<div class="container">
		<div class="row justify-content-center">
			<div class="col-lg-12">
				<div class="search-query-display mb-4">
					<h2 class="text-center mb-3">
						Flight Search: {{ origin|upper }} → {{ destination|upper }}
					</h2>
					<div class="text-center text-muted">
						<p>
							<strong>Departure:</strong> {{ depart_date }}
							{% if return_date and trip_type == '2' %}
							| <strong>Return:</strong> {{ return_date }}
							{% endif %}
							| <strong>Class:</strong> {{ seat|title }}
						</p>
					</div>
				</div>

				<!-- Loading Indicator -->
				<div id="search-loading" class="text-center py-4" style="display: none;">
					<div class="loading-spinner"></div>
					<p class="mt-3">Searching flights from multiple sources...</p>
				</div>

				<!-- Search Results Tabs -->
				<div id="flight-results-container">
					<ul class="nav nav-tabs flight-result-tabs justify-content-center" role="tablist">
						<li class="nav-item">
							<a class="nav-link active" data-toggle="tab" href="#local-results" role="tab">
								<i class="fas fa-database"></i> Local Database
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" data-toggle="tab" href="#amadeus-results" role="tab">
								<i class="fas fa-satellite"></i> Live Results <span class="amadeus-badge">AMADEUS</span>
							</a>
						</li>
						<li class="nav-item">
							<a class="nav-link" data-toggle="tab" href="#comparison" role="tab">
								<i class="fas fa-chart-bar"></i> Compare
							</a>
						</li>
					</ul>

					<div class="tab-content mt-4">
						<!-- Local Database Results Tab -->
						<div class="tab-pane active" id="local-results" role="tabpanel">
							<div class="text-center py-4">
								<h5>Local Database Results</h5>
								<p class="text-muted">Click "Search Flights" above to search our local database</p>
								<a href="{% url 'flight' %}?Origin={{ origin }}&Destination={{ destination }}&DepartDate={{ depart_date }}&SeatClass={{ seat }}&TripType={{ trip_type }}{% if return_date %}&ReturnDate={{ return_date }}{% endif %}" 
								   class="btn btn-primary">
									Search Local Database
								</a>
							</div>
						</div>

						<!-- Amadeus Results Tab -->
						<div class="tab-pane" id="amadeus-results" role="tabpanel">
							<div id="amadeus-flights-container">
								<div class="text-center py-4">
									<h5>Live Flight Results</h5>
									<p class="text-muted">Real-time flight data from Amadeus API</p>
									<button onclick="performAmadeusSearch()" class="btn btn-success">
										<i class="fas fa-search"></i> Search Live Flights
									</button>
								</div>
							</div>
						</div>

						<!-- Comparison Tab -->
						<div class="tab-pane" id="comparison" role="tabpanel">
							<div id="price-comparison-container">
								<div class="text-center py-4">
									<h5>Price Comparison</h5>
									<p class="text-muted">Compare prices between local and live results</p>
									<button onclick="searchAllSources()" class="btn btn-warning">
										<i class="fas fa-search"></i> Search All Sources for Comparison
									</button>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>
{% endif %}

<div class="untree_co-section">
	<div class="container">
		<div class="row mb-5 justify-content-center">
			<div class="col-lg-6 text-center">
				<h2 class="section-title text-center mb-3">Our Services</h2>
				<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
			</div>
		</div>
		<div class="row align-items-stretch">
			<div class="col-lg-4 order-lg-1">
				<div class="h-100"><div class="frame h-100"><div class="feature-img-bg h-100" style="background-image: url('{% static 'tour/images/hero-slider-1.jpg' %}');"></div></div></div>
			</div>

			<div class="col-6 col-sm-6 col-lg-4 feature-1-wrap d-md-flex flex-md-column order-lg-1" >

				<div class="feature-1 d-md-flex">
					<div class="align-self-center">
						<span class="flaticon-house display-4 text-primary"></span>
						<h3>Beautiful Condo</h3>
						<p class="mb-0">Even the all-powerful Pointing has no control about the blind texts.</p>
					</div>
				</div>

				<div class="feature-1 ">
					<div class="align-self-center">
						<span class="flaticon-restaurant display-4 text-primary"></span>
						<h3>Restaurants & Cafe</h3>
						<p class="mb-0">Even the all-powerful Pointing has no control about the blind texts.</p>
					</div>
				</div>

			</div>

			<div class="col-6 col-sm-6 col-lg-4 feature-1-wrap d-md-flex flex-md-column order-lg-3" >

				<div class="feature-1 d-md-flex">
					<div class="align-self-center">
						<span class="flaticon-mail display-4 text-primary"></span>
						<h3>Easy to Connect</h3>
						<p class="mb-0">Even the all-powerful Pointing has no control about the blind texts.</p>
					</div>
				</div>

				<div class="feature-1 d-md-flex">
					<div class="align-self-center">
						<span class="flaticon-phone-call display-4 text-primary"></span>
						<h3>24/7 Support</h3>
						<p class="mb-0">Even the all-powerful Pointing has no control about the blind texts.</p>
					</div>
				</div>

			</div>

		</div>
	</div>
</div>

<div class="untree_co-section count-numbers py-5">
	<div class="container">
		<div class="row">
			<div class="col-6 col-sm-6 col-md-6 col-lg-3">
				<div class="counter-wrap">
					<div class="counter">
						<span class="" data-number="9313">0</span>
					</div>
					<span class="caption">No. of Travels</span>
				</div>
			</div>
			<div class="col-6 col-sm-6 col-md-6 col-lg-3">
				<div class="counter-wrap">
					<div class="counter">
						<span class="" data-number="8492">0</span>
					</div>
					<span class="caption">No. of Clients</span>
				</div>
			</div>
			<div class="col-6 col-sm-6 col-md-6 col-lg-3">
				<div class="counter-wrap">
					<div class="counter">
						<span class="" data-number="100">0</span>
					</div>
					<span class="caption">No. of Employees</span>
				</div>
			</div>
			<div class="col-6 col-sm-6 col-md-6 col-lg-3">
				<div class="counter-wrap">
					<div class="counter">
						<span class="" data-number="120">0</span>
					</div>
					<span class="caption">No. of Countries</span>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="untree_co-section">
	<div class="container">
		<div class="row text-center justify-content-center mb-5">
			<div class="col-lg-7"><h2 class="section-title text-center">Popular Destination</h2></div>
		</div>

		<div class="owl-carousel owl-3-slider">

			<div class="item">
				<a class="media-thumb" href="{% static 'tour/images/hero-slider-1.jpg' %}" data-fancybox="gallery">
					<div class="media-text">
						<h3>Pragser Wildsee</h3>
						<span class="location">Italy</span>
					</div>
					<img src="{% static 'tour/images/hero-slider-1.jpg' %}" alt="Image" class="img-fluid">
				</a> 
			</div>

			<div class="item">
				<a class="media-thumb" href="{% static 'tour/images/hero-slider-2.jpg' %}" data-fancybox="gallery">
					<div class="media-text">
						<h3>Oia</h3>
						<span class="location">Greece</span>
					</div>
					<img src="{% static 'tour/images/hero-slider-2.jpg' %}" alt="Image" class="img-fluid">
				</a> 
			</div>

			<div class="item">
				<a class="media-thumb" href="{% static 'tour/images/hero-slider-3.jpg' %}" data-fancybox="gallery">
					<div class="media-text">
						<h3>Perhentian Islands</h3>
						<span class="location">Malaysia</span>
					</div>
					<img src="{% static 'tour/images/hero-slider-3.jpg' %}" alt="Image" class="img-fluid">
				</a> 
			</div>


			<div class="item">
				<a class="media-thumb" href="{% static 'tour/images/hero-slider-4.jpg' %}" data-fancybox="gallery">
					<div class="media-text">
						<h3>Rialto Bridge</h3>
						<span class="location">Italy</span>
					</div>
					<img src="{% static 'tour/images/hero-slider-4.jpg' %}" alt="Image" class="img-fluid">
				</a> 
			</div>

			<div class="item">
				<a class="media-thumb" href="{% static 'tour/images/hero-slider-5.jpg' %}" data-fancybox="gallery">
					<div class="media-text">
						<h3>San Francisco, United States</h3>
						<span class="location">United States</span>
					</div>
					<img src="{% static 'tour/images/hero-slider-5.jpg' %}" alt="Image" class="img-fluid">
				</a> 
			</div>

			<div class="item">
				<a class="media-thumb" href="{% static 'tour/images/hero-slider-1.jpg' %}" data-fancybox="gallery">
					<div class="media-text">
						<h3>Lake Thun</h3>
						<span class="location">Switzerland</span>
					</div>
					<img src="{% static 'tour/images/hero-slider-2.jpg' %}" alt="Image" class="img-fluid">
				</a> 
			</div>

		</div>

	</div>
</div>


<div class="untree_co-section testimonial-section mt-5">
	<div class="container">
		<div class="row justify-content-center">
			<div class="col-lg-7 text-center">
				<h2 class="section-title text-center mb-5">Testimonials</h2>

				<div class="owl-single owl-carousel no-nav">
					<div class="testimonial mx-auto">
						<figure class="img-wrap">
							<img src="{% static 'tour/images/person_2.jpg' %}" alt="Image" class="img-fluid">
						</figure>
						<h3 class="name">Adam Aderson</h3>
						<blockquote>
							<p>&ldquo;There live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.&rdquo;</p>
						</blockquote>
					</div>

					<div class="testimonial mx-auto">
						<figure class="img-wrap">
							<img src="{% static 'tour/images/person_3.jpg' %}" alt="Image" class="img-fluid">
						</figure>
						<h3 class="name">Lukas Devlin</h3>
						<blockquote>
							<p>&ldquo;There live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.&rdquo;</p>
						</blockquote>
					</div>

					<div class="testimonial mx-auto">
						<figure class="img-wrap">
							<img src="{% static 'tour/images/person_4.jpg' %}" alt="Image" class="img-fluid">
						</figure>
						<h3 class="name">Kayla Bryant</h3>
						<blockquote>
							<p>&ldquo;There live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.&rdquo;</p>
						</blockquote>
					</div>

				</div>

			</div>
		</div>
	</div>
</div>


<div class="untree_co-section">
	<div class="container">
		<div class="row justify-content-center text-center mb-5">
			<div class="col-lg-6">
				<h2 class="section-title text-center mb-3">Special Offers &amp; Discounts</h2>
				<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>
			</div>
		</div>
		<div class="row">
			<div class="col-6 col-sm-6 col-md-6 col-lg-3 mb-4 mb-lg-0">
				<div class="media-1">
					<a href="#" class="d-block mb-3"><img src="{% static 'tour/images/hero-slider-1.jpg' %}" alt="Image" class="img-fluid"></a>
					<span class="d-flex align-items-center loc mb-2">
						<span class="icon-room mr-3"></span>
						<span>Italy</span>
					</span>
					<div class="d-flex align-items-center">
						<div>
							<h3><a href="#">Rialto Mountains</a></h3>
							<div class="price ml-auto">
								<span>$520.00</span>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-6 col-sm-6 col-md-6 col-lg-3 mb-4 mb-lg-0">
				<div class="media-1">
					<a href="#" class="d-block mb-3"><img src="{% static 'tour/images/hero-slider-2.jpg' %}" alt="Image" class="img-fluid"></a>
					<span class="d-flex align-items-center loc mb-2">
						<span class="icon-room mr-3"></span>
						<span>United States</span>
					</span>
					<div class="d-flex align-items-center">
						<div>
							<h3><a href="#">San Francisco</a></h3>
							<div class="price ml-auto">
								<span>$520.00</span>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-6 col-sm-6 col-md-6 col-lg-3 mb-4 mb-lg-0">
				<div class="media-1">
					<a href="#" class="d-block mb-3"><img src="{% static 'tour/images/hero-slider-3.jpg' %}" alt="Image" class="img-fluid"></a>
					<span class="d-flex align-items-center loc mb-2">
						<span class="icon-room mr-3"></span>
						<span>Malaysia</span>
					</span>
					<div class="d-flex align-items-center">
						<div>
							<h3><a href="#">Perhentian Islands</a></h3>
							<div class="price ml-auto">
								<span>$750.00</span>
							</div>
						</div>
					</div>
				</div>
			</div>
			<div class="col-6 col-sm-6 col-md-6 col-lg-3 mb-4 mb-lg-0">
				<div class="media-1">
					<a href="#" class="d-block mb-3"><img src="{% static 'tour/images/hero-slider-4.jpg' %}" alt="Image" class="img-fluid"></a>

					<span class="d-flex align-items-center loc mb-2">
						<span class="icon-room mr-3"></span>
						<span>Switzerland</span>
					</span>

					<div class="d-flex align-items-center">
						<div>
							<h3><a href="#">Lake Thun</a></h3>
							<div class="price ml-auto">
								<span>$520.00</span>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<div class="untree_co-section">
	<div class="container">
		<div class="row justify-content-between align-items-center">
			
			<div class="col-lg-6">
				<figure class="img-play-video">
					<a id="play-video" class="video-play-button" href="https://www.youtube.com/watch?v=mwtbEGNABWU" data-fancybox>
						<span></span>
					</a>
					<img src="{% static 'tour/images/hero-slider-2.jpg' %}" alt="Image" class="img-fluid rounded-20">
				</figure>
			</div>

			<div class="col-lg-5">
				<h2 class="section-title text-left mb-4">Take a look at Tour Video</h2>
				<p>Far far away, behind the word mountains, far from the countries Vokalia and Consonantia, there live the blind texts. Separated they live in Bookmarksgrove right at the coast of the Semantics, a large language ocean.</p>

				<p class="mb-4">A small river named Duden flows by their place and supplies it with the necessary regelialia. It is a paradisematic country, in which roasted parts of sentences fly into your mouth.</p>

				<ul class="list-unstyled two-col clearfix">
					<li>Outdoor recreation activities</li>
					<li>Airlines</li>
					<li>Car Rentals</li>
					<li>Cruise Lines</li>
					<li>Hotels</li>
					<li>Railways</li>
					<li>Travel Insurance</li>
					<li>Package Tours</li>
					<li>Insurance</li>
					<li>Guide Books</li>
				</ul>

				<p><a href="#" class="btn btn-primary">Get Started</a></p>
			</div>
		</div>
	</div>
</div>

<div class="py-5 cta-section">
	<div class="container">
		<div class="row text-center">
			<div class="col-md-12">
				<h2 class="mb-2 text-white">Lets you Explore the Best. Contact Us Now</h2>
				<p class="mb-4 lead text-white text-white-opacity">Lorem ipsum dolor sit amet, consectetur adipisicing elit. Excepturi, fugit?</p>
				<p class="mb-0"><a href="booking.html" class="btn btn-outline-white text-white btn-md font-weight-bold">Get in touch</a></p>
			</div>
		</div>
	</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tour = new Shepherd.Tour({
        useModalOverlay: true,
        defaultStepOptions: {
            cancelIcon: {
                enabled: true
            },
            classes: 'shepherd-theme-arrows',
            scrollTo: { behavior: 'smooth', block: 'center' }
        }
    });

    tour.addStep({
        id: 'trip-type',
        text: 'Select the type of trip: One-way or Round Trip.',
        attachTo: {
            element: '.trip-type',
            on: 'bottom'
        },
        buttons: [
            {
                text: 'Next',
                action: tour.next
            }
        ]
    });

    tour.addStep({
        id: 'flight-from',
        text: 'Enter the origin of your flight.',
        attachTo: {
            element: '#flight-from',
            on: 'bottom'
        },
        buttons: [
            {
                text: 'Next',
                action: tour.next
            }
        ]
    });

    tour.addStep({
        id: 'flight-to',
        text: 'Enter the destination of your flight.',
        attachTo: {
            element: '#flight-to',
            on: 'bottom'
        },
        buttons: [
            {
                text: 'Next',
                action: tour.next
            }
        ]
    });

    tour.addStep({
        id: 'depart-date',
        text: 'Select the departure date for your flight.',
        attachTo: {
            element: '#depart_date',
            on: 'bottom'
        },
        buttons: [
            {
                text: 'Next',
                action: tour.next
            }
        ]
    });

    tour.addStep({
        id: 'return-date',
        text: 'Select the return date for your flight (if Round Trip).',
        attachTo: {
            element: '#return_date',
            on: 'bottom'
        },
        buttons: [
            {
                text: 'Next',
                action: tour.next
            }
        ]
    });

    tour.addStep({
        id: 'seat-class',
        text: 'Choose the class for your flight: Economy, Business, or First.',
        attachTo: {
            element: '#SeatType',
            on: 'bottom'
        },
        buttons: [
            {
                text: 'Next',
                action: tour.next
            }
        ]
    });

    tour.addStep({
        id: 'search-flight',
        text: 'Click here to search for available flights.',
        attachTo: {
            element: '.btn-info',
            on: 'bottom'
        },
        buttons: [
            {
                text: 'Finish',
                action: tour.complete
            }
        ]
    });

    tour.start();
});
</script>

<!-- Amadeus Integration JavaScript -->
<script>
    // Search parameters from Django template
    const searchParams = {
        origin: '{{ origin|default:"" }}',
        destination: '{{ destination|default:"" }}',
        departDate: '{{ depart_date|default:"" }}',
        returnDate: '{{ return_date|default:"" }}',
        seatClass: '{{ seat|default:"economy" }}',
        tripType: '{{ trip_type|default:"1" }}',
        adults: 1
    };

    // Perform Amadeus search
    async function performAmadeusSearch() {
        if (!searchParams.origin || !searchParams.destination || !searchParams.departDate) {
            alert('Please fill in all required search fields first.');
            return;
        }

        showLoading();
        
        try {
            const results = await amadeusClient.searchFlights(searchParams);
            hideLoading();
            
            if (results.error) {
                showError('Amadeus search failed: ' + results.message);
                return;
            }
            
            displayAmadeusResults(results.flights);
            
            // Switch to Amadeus results tab
            document.querySelector('a[href="#amadeus-results"]').click();
            
        } catch (error) {
            hideLoading();
            showError('Search failed: ' + error.message);
        }
    }

    // Search all sources for comparison
    async function searchAllSources() {
        if (!searchParams.origin || !searchParams.destination || !searchParams.departDate) {
            alert('Please fill in all required search fields first.');
            return;
        }

        showLoading();
        
        try {
            // Search Amadeus
            const amadeusResults = await amadeusClient.searchFlights(searchParams);
            
            hideLoading();
            
            if (!amadeusResults.error) {
                displayAmadeusResults(amadeusResults.flights);
                displayComparison(amadeusResults.flights);
                
                // Switch to comparison tab
                document.querySelector('a[href="#comparison"]').click();
            } else {
                showError('Live search failed: ' + amadeusResults.message);
            }
            
        } catch (error) {
            hideLoading();
            showError('Search failed: ' + error.message);
        }
    }

    // Display Amadeus results
    function displayAmadeusResults(flights) {
        const container = document.getElementById('amadeus-flights-container');
        
        if (!flights || flights.length === 0) {
            container.innerHTML = `
                <div class="alert alert-info text-center">
                    <h5>No Live Flights Found</h5>
                    <p>No flights found for your search criteria. Try adjusting your dates or destinations.</p>
                </div>
            `;
            return;
        }
        
        let html = `
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h5><span class="amadeus-badge">LIVE</span> Found ${flights.length} flights</h5>
                <small class="text-muted">Powered by Amadeus API</small>
            </div>
        `;
        
        flights.forEach(flight => {
            const formatted = amadeusClient.formatFlightForDisplay(flight);
            html += `
                <div class="card mb-3 amadeus-flight-card">
                    <div class="card-body">
                        <div class="row align-items-center">
                            <div class="col-md-3">
                                <div class="airline-info">
                                    <h6 class="mb-1">${formatted.airline}</h6>
                                    <small class="text-muted">${formatted.flightNumber}</small>
                                    <div><small class="text-muted">${formatted.aircraft}</small></div>
                                </div>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="flight-route">
                                    <div class="row align-items-center">
                                        <div class="col-4 text-center">
                                            <div class="departure">
                                                <div class="h5 mb-0">${formatted.departTime}</div>
                                                <div class="text-muted">${formatted.origin.code}</div>
                                            </div>
                                        </div>
                                        <div class="col-4 text-center">
                                            <div class="flight-route-visual"></div>
                                            <small class="text-muted d-block">${formatted.duration}</small>
                                            <small class="text-muted">
                                                ${formatted.isDirect ? 'Direct' : formatted.stops + ' stop(s)'}
                                            </small>
                                        </div>
                                        <div class="col-4 text-center">
                                            <div class="arrival">
                                                <div class="h5 mb-0">${formatted.arrivalTime}</div>
                                                <div class="text-muted">${formatted.destination.code}</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-3 text-center">
                                <div class="price-info">
                                    <div class="price-highlight">
                                        ${formatted.price.currency} ${formatted.price.total}
                                    </div>
                                    <small class="text-muted d-block">${formatted.availableSeats} seats left</small>
                                    <button class="btn btn-success btn-sm mt-2" 
                                            onclick="selectAmadeusFlight('${formatted.offerId}')">
                                        Select Flight
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }

    // Display comparison
    function displayComparison(amadeusFlights) {
        const container = document.getElementById('price-comparison-container');
        
        if (!amadeusFlights || amadeusFlights.length === 0) {
            container.innerHTML = `
                <div class="alert alert-warning text-center">
                    <h5>No Comparison Available</h5>
                    <p>Search both sources to see price comparison.</p>
                </div>
            `;
            return;
        }
        
        // Calculate price statistics
        const prices = amadeusFlights.map(f => f.price.total);
        const minPrice = Math.min(...prices);
        const maxPrice = Math.max(...prices);
        const avgPrice = prices.reduce((a, b) => a + b, 0) / prices.length;
        
        const html = `
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><span class="amadeus-badge">LIVE</span> Amadeus Results</h6>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-4">
                                    <h5 class="text-success">${amadeusFlights[0].price.currency} ${minPrice}</h5>
                                    <small class="text-muted">Lowest Price</small>
                                </div>
                                <div class="col-4">
                                    <h5 class="text-primary">${amadeusFlights[0].price.currency} ${avgPrice.toFixed(0)}</h5>
                                    <small class="text-muted">Average Price</small>
                                </div>
                                <div class="col-4">
                                    <h5 class="text-warning">${amadeusFlights[0].price.currency} ${maxPrice}</h5>
                                    <small class="text-muted">Highest Price</small>
                                </div>
                            </div>
                            <hr>
                            <p class="text-center mb-0">
                                <strong>${amadeusFlights.length}</strong> live flights found
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h6 class="mb-0"><i class="fas fa-database"></i> Local Database</h6>
                        </div>
                        <div class="card-body">
                            <div class="text-center">
                                <p class="text-muted">Search local database to compare prices</p>
                                <a href="{% url 'flight' %}?Origin={{ origin }}&Destination={{ destination }}&DepartDate={{ depart_date }}&SeatClass={{ seat }}&TripType={{ trip_type }}{% if return_date %}&ReturnDate={{ return_date }}{% endif %}" 
                                   class="btn btn-primary">
                                    Search Local Database
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row mt-4">
                <div class="col-12">
                    <div class="alert alert-info">
                        <h6><i class="fas fa-lightbulb"></i> Price Insight</h6>
                        <p class="mb-0">
                            ${minPrice < avgPrice * 0.8 ? 
                                'Great deal found! The lowest price is significantly below average.' :
                                'Prices are within normal range for this route.'
                            }
                        </p>
                    </div>
                </div>
            </div>
        `;
        
        container.innerHTML = html;
    }

    // Select Amadeus flight
    function selectAmadeusFlight(offerId) {
        // Store selected offer for booking
        sessionStorage.setItem('selectedAmadeusOffer', offerId);
        sessionStorage.setItem('searchParams', JSON.stringify(searchParams));
        
        alert(`Flight selected! Offer ID: ${offerId}\n\nIn a full implementation, this would proceed to passenger details and booking.`);
        
        // TODO: Implement booking flow
        // window.location.href = '/amadeus/book?offer=' + offerId;
    }

    // Utility functions
    function showLoading() {
        document.getElementById('search-loading').style.display = 'block';
    }

    function hideLoading() {
        document.getElementById('search-loading').style.display = 'none';
    }

    function showError(message) {
        const alertHtml = `
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong>Error:</strong> ${message}
                <button type="button" class="close" data-dismiss="alert">
                    <span>&times;</span>
                </button>
            </div>
        `;
        
        // Insert error at the top of results container
        const container = document.getElementById('flight-results-container');
        container.insertAdjacentHTML('afterbegin', alertHtml);
    }

    // Auto-search if we have search parameters
    document.addEventListener('DOMContentLoaded', function() {
        {% if origin and destination and depart_date %}
            // Show the search results section
            document.querySelector('.flight-search-results').style.display = 'block';
            
            // Optionally auto-search Amadeus if requested
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('auto_amadeus') === 'true') {
                setTimeout(performAmadeusSearch, 1000);
            }
        {% endif %}
    });
</script>

{% endblock %}
